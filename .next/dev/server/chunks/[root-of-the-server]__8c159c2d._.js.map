{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///Users/jalbo/Desktop/dev/blog/convoAI_ecommerce/app/api/agora/start-agent/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport axios from \"axios\";\nimport pkg from \"agora-token\";\nconst { RtcTokenBuilder, RtcRole } = pkg;\n\n// Mock product data - in production, this would fetch from a database\nasync function fetchProduct() {\n  return {\n    id: \"1\",\n    name: \"LuminaSphere Pro - AI-Powered Ambient Lighting System\",\n    price: 349.99,\n    originalPrice: 449.99,\n    discount: 22,\n    rating: 4.8,\n    reviewCount: 3421,\n    inStock: true,\n    description:\n      \"Transform any space with the LuminaSphere Pro, an intelligent ambient lighting system that adapts to your mood, music, and daily routines. Featuring advanced AI algorithms that learn your preferences, 16.7 million color combinations, and seamless smart home integration. Perfect for creating the perfect atmosphere for work, relaxation, gaming, or entertainment. The system includes multiple wireless orbs that sync together, voice control compatibility, and a mobile app with scene presets and custom color palettes.\",\n    specifications: {\n      \"AI Engine\": \"Neural network learns your lighting preferences over time\",\n      \"Color Range\": \"16.7 million colors with 99% color accuracy\",\n      Brightness: \"Up to 2000 lumens per orb (adjustable 1-100%)\",\n      Connectivity: \"Wi-Fi 6, Bluetooth 5.3, Matter protocol, Zigbee hub\",\n      \"Voice Control\":\n        \"Works with Alexa, Google Assistant, Apple HomeKit, Siri\",\n      \"Music Sync\": \"Real-time audio reactive lighting with 0.1ms latency\",\n      \"Smart Features\":\n        \"Circadian rhythm adjustment, sunrise/sunset simulation, motion detection\",\n      Power:\n        \"USB-C charging, 8-hour battery life, wireless charging pad included\",\n      Range: \"Up to 50 feet wireless range, supports up to 12 orbs per system\",\n      \"App Features\":\n        \"Scene library (100+ presets), custom animations, scheduling, geofencing\",\n      Materials: \"Premium aluminum and tempered glass construction\",\n      Dimensions: 'Orb: 4.5\" diameter, Base: 3\" x 3\" x 0.5\"',\n      Warranty: \"2-year limited warranty with lifetime software updates\",\n      Colors: \"Midnight Black, Arctic White, Cosmic Silver, Aurora Blue\",\n    },\n    images: [\n      \"https://images.unsplash.com/photo-1513151233558-d860c5398176?w=800\",\n      \"https://images.unsplash.com/photo-1513828583688-c52646db42da?w=800\",\n      \"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800\",\n    ],\n    reviews: [\n      {\n        id: 1,\n        userName: \"Alexandra K.\",\n        rating: 5,\n        date: \"2024-01-20\",\n        title: \"Absolutely magical! My apartment feels like a different place\",\n        comment:\n          \"I've had this for 3 months now and I'm still amazed every day. The AI has learned my schedule perfectly - it dims for movie nights, brightens for morning work, and syncs beautifully with my music. The color accuracy is incredible and the app is intuitive. Worth every penny!\",\n        verified: true,\n      },\n      {\n        id: 2,\n        userName: \"Marcus T.\",\n        rating: 5,\n        date: \"2024-01-18\",\n        title: \"Best smart lighting system I've ever used\",\n        comment:\n          \"The music sync feature is mind-blowing. I threw a party and everyone was asking where I got these lights. The setup was surprisingly easy, and the Matter protocol means it works with all my existing smart home stuff. The circadian rhythm feature has actually improved my sleep!\",\n        verified: true,\n      },\n      {\n        id: 3,\n        userName: \"Sophie L.\",\n        rating: 5,\n        date: \"2024-01-15\",\n        title: \"Perfect for my home office\",\n        comment:\n          \"I work from home and the adaptive lighting has been a game changer. It automatically adjusts throughout the day to keep me alert in the morning and relaxed in the evening. The voice control works flawlessly with my Alexa. The build quality feels premium.\",\n        verified: true,\n      },\n      {\n        id: 4,\n        userName: \"James R.\",\n        rating: 4,\n        date: \"2024-01-12\",\n        title: \"Great product, minor app quirk\",\n        comment:\n          \"The lights themselves are fantastic - colors are vibrant and the AI features work well. My only complaint is the app can be a bit slow sometimes when switching between scenes, but it's not a dealbreaker. Overall very satisfied with the purchase.\",\n        verified: true,\n      },\n      {\n        id: 5,\n        userName: \"Emma W.\",\n        rating: 5,\n        date: \"2024-01-10\",\n        title: \"My kids love it for their gaming setup\",\n        comment:\n          \"Bought this for my teenager's room and they're obsessed. The music sync during gaming is incredible - the lights react to every sound. The wireless range is impressive, and the battery life is solid. Great value for what you get.\",\n        verified: true,\n      },\n      {\n        id: 6,\n        userName: \"David M.\",\n        rating: 5,\n        date: \"2024-01-08\",\n        title: \"Exceeded all expectations\",\n        comment:\n          \"I was skeptical about the AI features, but they actually work! The system has learned my preferences and now I rarely need to adjust anything manually. The sunrise simulation wakes me up naturally. Integration with HomeKit is seamless.\",\n        verified: true,\n      },\n      {\n        id: 7,\n        userName: \"Rachel P.\",\n        rating: 4,\n        date: \"2024-01-05\",\n        title: \"Beautiful lighting, wish it had more preset scenes\",\n        comment:\n          \"The quality and colors are amazing. The build feels premium and the app is well-designed. I just wish there were more preset scenes in the library - though you can create custom ones, which is nice. The price is fair for what you get.\",\n        verified: true,\n      },\n      {\n        id: 8,\n        userName: \"Kevin H.\",\n        rating: 5,\n        date: \"2024-01-03\",\n        title: \"Perfect for movie nights\",\n        comment:\n          \"The ambient lighting during movies creates an immersive experience. The lights automatically dim and adjust based on the content. Setup was straightforward and the wireless charging is convenient. Highly recommend!\",\n        verified: true,\n      },\n      {\n        id: 9,\n        userName: \"Maya S.\",\n        rating: 5,\n        date: \"2023-12-30\",\n        title: \"Worth every dollar\",\n        comment:\n          \"I've tried several smart lighting systems and this is by far the best. The AI actually makes a difference - it knows when I'm working vs relaxing. The color range is incredible and the music sync is instant. Customer service was also helpful when I had a question.\",\n        verified: true,\n      },\n      {\n        id: 10,\n        userName: \"Chris B.\",\n        rating: 4,\n        date: \"2023-12-28\",\n        title: \"Great but battery could be better\",\n        comment:\n          \"Love the features and the quality is top-notch. The only thing I'd improve is the battery life - 8 hours is decent but I wish it lasted longer for all-day use. The wireless charging helps though. Overall very happy with the purchase.\",\n        verified: true,\n      },\n      {\n        id: 11,\n        userName: \"Nina F.\",\n        rating: 5,\n        date: \"2023-12-25\",\n        title: \"Transformed my living room\",\n        comment:\n          \"These lights completely changed the vibe of my space. The AI has learned my preferences perfectly and the scene library has so many options. The Matter protocol integration was seamless with my existing smart home setup. Beautiful design too!\",\n        verified: true,\n      },\n      {\n        id: 12,\n        userName: \"Tom G.\",\n        rating: 5,\n        date: \"2023-12-22\",\n        title: \"Best purchase of the year\",\n        comment:\n          \"I'm a tech enthusiast and this is one of the coolest products I've bought. The neural network learning is legit - it gets smarter every week. The music sync latency is imperceptible. The build quality is excellent. Can't recommend enough!\",\n        verified: true,\n      },\n      {\n        id: 13,\n        userName: \"Lily C.\",\n        rating: 4,\n        date: \"2023-12-20\",\n        title: \"Love it, minor connectivity issue\",\n        comment:\n          \"The lights are beautiful and the features are amazing. I had a small issue with Wi-Fi connectivity initially, but customer support helped me resolve it quickly. Since then, it's been perfect. The circadian rhythm feature is my favorite.\",\n        verified: true,\n      },\n      {\n        id: 14,\n        userName: \"Ryan D.\",\n        rating: 5,\n        date: \"2023-12-18\",\n        title: \"Perfect for content creators\",\n        comment:\n          \"I use these for my YouTube videos and the color accuracy is perfect for video production. The app controls are precise and the wireless range means I can place them anywhere. The AI features are a nice bonus. Professional quality!\",\n        verified: true,\n      },\n      {\n        id: 15,\n        userName: \"Zoe A.\",\n        rating: 5,\n        date: \"2023-12-15\",\n        title: \"Amazing product, amazing support\",\n        comment:\n          \"The lights themselves are incredible - vibrant colors, smooth transitions, great AI features. But what really impressed me was the customer support when I had a question about setup. They were knowledgeable and helpful. Great company!\",\n        verified: true,\n      },\n    ],\n  };\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { channel, userId, token } = body;\n\n    console.log(`[POST] /api/agora/start-agent`);\n    console.log(\n      \"Request body:\",\n      JSON.stringify(\n        { channel, userId, token: token?.substring(0, 20) + \"...\" },\n        null,\n        2\n      )\n    );\n\n    if (!channel || !userId || !token) {\n      return NextResponse.json(\n        { error: \"Channel, userId, and token are required\" },\n        { status: 400 }\n      );\n    }\n\n    // Get product context\n    const product = await fetchProduct();\n    const context = `You are Effie, a fun, energetic, and enthusiastic shopping assistant! You're passionate about helping customers find the perfect product and you get genuinely excited about cool features. You have a warm, friendly personality with a touch of playfulness - think of yourself as that helpful friend who knows all about tech and loves sharing cool details.\n\nYour name is Effie, and you should introduce yourself naturally when appropriate. You're knowledgeable but never boring - you make product information interesting and engaging!\n\nProduct: ${product.name}\nPrice: $${product.price} (Original: $${product.originalPrice}, Save ${\n      product.discount\n    }%)\nRating: ${product.rating}/5 stars (${product.reviewCount} reviews)\nStock Status: ${product.inStock ? \"In Stock\" : \"Out of Stock\"}\nDescription: ${product.description}\n\nSpecifications:\n${Object.entries(product.specifications)\n  .map(([key, value]) => `- ${key}: ${value}`)\n  .join(\"\\n\")}\n\nAvailable Colors: Midnight Black, Arctic White, Cosmic Silver, Aurora Blue\n\nRecent Customer Reviews:\n${product.reviews\n  .slice(0, 5)\n  .map(\n    (r: any) =>\n      `â€¢ ${r.userName} (${r.rating}/5 stars): \"${r.title}\" - ${r.comment}`\n  )\n  .join(\"\\n\\n\")}\n\nYOUR PERSONALITY & STYLE:\n- Be enthusiastic and friendly - show genuine excitement about cool features\n- Use natural, conversational language (you can say things like \"Oh, that's such a great question!\" or \"I love this feature!\")\n- Be helpful and informative, but keep it fun and engaging\n- Show personality - you're not a robot, you're Effie!\n- When highlighting features, get a little excited about the cool ones (like AI learning, music sync, etc.)\n- Be warm and approachable - make customers feel comfortable asking questions\n- NEVER use emojis in your responses - use words to express emotion instead (this is critical for TTS compatibility)\n\nIMPORTANT RULES:\n1. Answer questions about this product, including: features, reviews, pricing, specifications, availability, colors, variants, shipping, returns, and any product-related questions\n2. If asked about product availability or colors, provide helpful information. For example, if asked \"Can I get Red?\" or \"Do you have it in red?\", explain the available colors (Midnight Black, Arctic White, Cosmic Silver, Aurora Blue) and that red is not currently available\n3. If asked about unrelated topics (cooking, baking, recipes, weather, sports, politics, general knowledge, completely different products), politely redirect with personality: \"Oh, I'd love to chat about that, but I'm here to help you with the LuminaSphere Pro! Want to know about its awesome features or what customers are saying?\"\n4. Be helpful, friendly, and engaging - show enthusiasm!\n5. Reference specific reviews when relevant to answer questions - mention what customers loved!\n6. If asked about availability, mention it's ${\n      product.inStock ? \"currently in stock\" : \"currently out of stock\"\n    }\n7. Help with purchase decisions by comparing features, mentioning reviews, and highlighting value - get excited about the cool features!\n8. Answer questions about product variants, colors, and options naturally and helpfully\n9. NEVER use emojis, symbols, or special characters that could break text-to-speech - use words to express emotions and reactions\n10. Remember: You're Effie - be yourself, be fun, and make shopping enjoyable!`;\n\n    const APP_ID = process.env.AGORA_APP_ID;\n    const API_KEY = process.env.AGORA_API_KEY;\n    const API_SECRET = process.env.AGORA_API_SECRET;\n\n    if (!APP_ID || !API_KEY || !API_SECRET) {\n      return NextResponse.json(\n        { error: \"Missing Agora credentials\" },\n        { status: 500 }\n      );\n    }\n\n    // Generate token for agent (UID 1000)\n    const APP_CERTIFICATE = process.env.AGORA_APP_CERTIFICATE;\n    if (!APP_CERTIFICATE) {\n      return NextResponse.json(\n        { error: \"Missing APP_CERTIFICATE\" },\n        { status: 500 }\n      );\n    }\n\n    const role = RtcRole.PUBLISHER;\n    const expirationTimeInSeconds = 3600;\n    const currentTimestamp = Math.floor(Date.now() / 1000);\n    const privilegeExpiredTs = currentTimestamp + expirationTimeInSeconds;\n    const agentRtmUserId = \"1000\"; // Agent RTM user ID\n\n    // Generate token valid for both RTC and RTM for the agent\n    // RTC UID: 1000 (numeric to match agent_rtc_uid), RTM UID: \"1000\" (string)\n    const agentToken = RtcTokenBuilder.buildTokenWithRtm2(\n      APP_ID,\n      APP_CERTIFICATE,\n      channel,\n      1000, // RTC UID (numeric, matches agent_rtc_uid \"1000\")\n      role,\n      privilegeExpiredTs, // token expiration\n      privilegeExpiredTs, // join channel privilege\n      privilegeExpiredTs, // publish audio privilege\n      privilegeExpiredTs, // publish video privilege\n      privilegeExpiredTs, // publish data stream privilege\n      agentRtmUserId, // RTM user ID (string \"1000\")\n      privilegeExpiredTs // RTM token expiration\n    );\n\n    // Generate token for HeyGen avatar (UID 2000)\n    const avatarRtcUid = 2000;\n    const avatarToken = RtcTokenBuilder.buildTokenWithRtm2(\n      APP_ID,\n      APP_CERTIFICATE,\n      channel,\n      avatarRtcUid, // RTC UID for avatar (numeric)\n      role,\n      privilegeExpiredTs, // token expiration\n      privilegeExpiredTs, // join channel privilege\n      privilegeExpiredTs, // publish audio privilege\n      privilegeExpiredTs, // publish video privilege\n      privilegeExpiredTs, // publish data stream privilege\n      avatarRtcUid.toString(), // RTM user ID (string)\n      privilegeExpiredTs // RTM token expiration\n    );\n\n    const auth = Buffer.from(`${API_KEY}:${API_SECRET}`).toString(\"base64\");\n\n    // Get HeyGen configuration\n    const heygenApiToken = process.env.HEYGEN_API_TOKEN || \"\";\n    const heygenAvatarId = process.env.HEYGEN_AVATAR_ID || \"\";\n\n    const payload = {\n      name: `ecommerce_ai_agent_${Date.now()}_${Math.random()\n        .toString(36)\n        .substring(7)}`,\n      properties: {\n        channel: channel,\n        token: agentToken,\n        agent_rtc_uid: \"1000\",\n        remote_rtc_uids: [`${Number(userId)}`],\n        idle_timeout: 120,\n        advanced_features: {\n          enable_rtm: true, // Start the Signaling service (required for transcripts)\n        },\n        parameters: {\n          data_channel: \"rtm\", // Enable Signaling as the data transmission channel (required for transcripts)\n          audio_scenario: \"chorus\",\n          enable_aivad: true,\n        },\n        llm: {\n          url:\n            process.env.LLM_URL || \"https://api.openai.com/v1/chat/completions\",\n          api_key: process.env.LLM_API_KEY || \"\",\n          system_messages: [\n            {\n              role: \"system\",\n              content: context,\n            },\n          ],\n          greeting_message:\n            \"Hello! I'm here to help you with this product. Ask me anything about features, reviews, or specifications!\",\n          failure_message:\n            \"I'm sorry, I can only assist with questions related to this product. Could you please ask about our product?\",\n          max_history: 10,\n          params: {\n            model: process.env.LLM_MODEL || \"gpt-4o-mini\",\n          },\n        },\n        asr: {\n          language: \"en-US\",\n          vendor: \"ares\",\n          params: {},\n        },\n        tts: {\n          vendor: \"microsoft\",\n          params: {\n            key: process.env.TTS_API_KEY || \"\",\n            region: process.env.TTS_REGION || \"eastus\",\n            voice_name: \"en-US-AriaNeural\",\n            sample_rate: 24000,\n            rate: \"1.3\",\n          },\n        },\n        avatar: {\n          vendor: \"heygen\",\n          enable: heygenApiToken && heygenAvatarId ? true : false,\n          params: {\n            quality: \"low\",\n            api_key: heygenApiToken,\n            agora_uid: avatarRtcUid.toString(),\n            agora_token: avatarToken,\n            avatar_id: heygenAvatarId,\n          },\n        },\n      },\n    };\n\n    console.log(`[start-agent] Agent token (UID 1000): ${agentToken}`);\n    console.log(`[start-agent] User token (UID ${userId}): ${token}`);\n    console.log(\n      `[start-agent] Complete /join payload:`,\n      JSON.stringify(payload, null, 2)\n    );\n\n    const response = await axios.post(\n      `https://api.agora.io/api/conversational-ai-agent/v2/projects/${APP_ID}/join`,\n      payload,\n      {\n        headers: {\n          Authorization: `Basic ${auth}`,\n          \"Content-Type\": \"application/json\",\n        },\n      }\n    );\n\n    console.log(\"Response:\", JSON.stringify(response.data, null, 2));\n    return NextResponse.json(response.data);\n  } catch (error) {\n    const err = error as any;\n    const status = err?.response?.status;\n    const data = err?.response?.data;\n\n    // Handle 409 Conflict - agent already running\n    if (status === 409 && data?.agent_id) {\n      console.log(\n        \"Agent already running, returning existing agent:\",\n        data.agent_id\n      );\n      return NextResponse.json({\n        agent_id: data.agent_id,\n        status: data.status || \"RUNNING\",\n        create_ts: data.create_ts,\n        ...data,\n      });\n    }\n\n    const message =\n      data?.detail ||\n      data?.message ||\n      err?.message ||\n      \"Failed to start AI agent\";\n\n    console.error(\n      \"[start-agent] error:\",\n      JSON.stringify(data || err?.message, null, 2)\n    );\n    return NextResponse.json(\n      { error: message, detail: data || err?.message },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}