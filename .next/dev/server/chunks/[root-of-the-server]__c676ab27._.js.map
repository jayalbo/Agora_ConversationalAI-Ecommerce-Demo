{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///Users/jalbo/Desktop/dev/blog/convoAI_ecommerce/app/api/agora/leave-agent/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport axios from \"axios\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { agentId, credentials } = body;\n\n    if (!agentId) {\n      return NextResponse.json(\n        { error: \"agentId is required\" },\n        { status: 400 }\n      );\n    }\n\n    // Use credentials from request body with fallback to environment variables\n    const APP_ID = credentials?.agora?.appId || process.env.AGORA_APP_ID;\n    const API_KEY = credentials?.agora?.apiKey || process.env.AGORA_API_KEY;\n    const API_SECRET = credentials?.agora?.apiSecret || process.env.AGORA_API_SECRET;\n\n    if (!APP_ID || !API_KEY || !API_SECRET) {\n      return NextResponse.json(\n        { error: \"Missing Agora credentials. Please configure in Settings.\" },\n        { status: 400 }\n      );\n    }\n\n    const auth = Buffer.from(`${API_KEY}:${API_SECRET}`).toString(\"base64\");\n\n    console.log(`[leave-agent] Attempting to leave agent: ${agentId}`);\n\n    // Try POST with agent ID in the path (most likely format)\n    const response = await axios.post(\n      `https://api.agora.io/api/conversational-ai-agent/v2/projects/${APP_ID}/agents/${agentId}/leave`,\n      {},\n      {\n        headers: {\n          Authorization: `Basic ${auth}`,\n          \"Content-Type\": \"application/json\",\n        },\n      }\n    );\n\n    console.log(`[leave-agent] Successfully left agent: ${agentId}`);\n\n    return NextResponse.json(response.data);\n  } catch (error) {\n    const err = error as any;\n    const status = err?.response?.status;\n    const data = err?.response?.data;\n\n    const message =\n      data?.detail ||\n      data?.message ||\n      err?.message ||\n      \"Failed to leave AI agent\";\n\n    console.error(\n      \"[leave-agent] error - Status:\",\n      status,\n      \"URL:\",\n      `https://api.agora.io/api/conversational-ai-agent/v2/projects/${body.credentials?.agora?.appId || process.env.AGORA_APP_ID}/agents/${agentId}/leave`,\n      \"Response:\",\n      JSON.stringify(data || err?.message, null, 2)\n    );\n    return NextResponse.json(\n      { error: message, detail: data || err?.message, status: status },\n      { status: status || 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,QAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,SAAA,QAAO,EAAE,WAAW,EAAE,GAAG;QAEjC,IAAI,CAAC,UAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,2EAA2E;QAC3E,MAAM,SAAS,aAAa,OAAO,SAAS,QAAQ,GAAG,CAAC,YAAY;QACpE,MAAM,UAAU,aAAa,OAAO,UAAU,QAAQ,GAAG,CAAC,aAAa;QACvE,MAAM,aAAa,aAAa,OAAO,aAAa,QAAQ,GAAG,CAAC,gBAAgB;QAEhF,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,YAAY;YACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2D,GACpE;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,OAAO,IAAI,CAAC,GAAG,QAAQ,CAAC,EAAE,YAAY,EAAE,QAAQ,CAAC;QAE9D,QAAQ,GAAG,CAAC,CAAC,yCAAyC,EAAE,UAAS;QAEjE,0DAA0D;QAC1D,MAAM,WAAW,MAAM,kJAAK,CAAC,IAAI,CAC/B,CAAC,6DAA6D,EAAE,OAAO,QAAQ,EAAE,SAAQ,MAAM,CAAC,EAChG,CAAC,GACD;YACE,SAAS;gBACP,eAAe,CAAC,MAAM,EAAE,MAAM;gBAC9B,gBAAgB;YAClB;QACF;QAGF,QAAQ,GAAG,CAAC,CAAC,uCAAuC,EAAE,UAAS;QAE/D,OAAO,gJAAY,CAAC,IAAI,CAAC,SAAS,IAAI;IACxC,EAAE,OAAO,OAAO;QACd,MAAM,MAAM;QACZ,MAAM,SAAS,KAAK,UAAU;QAC9B,MAAM,OAAO,KAAK,UAAU;QAE5B,MAAM,UACJ,MAAM,UACN,MAAM,WACN,KAAK,WACL;QAEF,QAAQ,KAAK,CACX,iCACA,QACA,QACA,CAAC,6DAA6D,EAAE,KAAK,WAAW,EAAE,OAAO,SAAS,QAAQ,GAAG,CAAC,YAAY,CAAC,QAAQ,EAAE,QAAQ,MAAM,CAAC,EACpJ,aACA,KAAK,SAAS,CAAC,QAAQ,KAAK,SAAS,MAAM;QAE7C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAS,QAAQ,QAAQ,KAAK;YAAS,QAAQ;QAAO,GAC/D;YAAE,QAAQ,UAAU;QAAI;IAE5B;AACF"}}]
}