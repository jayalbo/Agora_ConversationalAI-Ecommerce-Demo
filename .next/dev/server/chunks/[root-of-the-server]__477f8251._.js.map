{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///Users/jalbo/Desktop/dev/blog/convoAI_ecommerce/lib/product.ts"],"sourcesContent":["// Mock product data - in production, this would fetch from a database\n// This is a simple demo showing how to integrate Agora Conversational AI with e-commerce\n//\n// NOTE: Product images are currently using placeholder Unsplash photos.\n// In production, replace these with actual product photos from your inventory.\n\nconst PRODUCTS: Record<string, any> = {\n  \"1\": {\n    id: \"1\",\n    name: \"LuminaSphere Pro - AI-Powered Ambient Lighting System\",\n    price: 349.99,\n    originalPrice: 449.99,\n    discount: 22,\n    rating: 4.8,\n    reviewCount: 3421,\n    inStock: true,\n    description:\n      \"Transform any space with the LuminaSphere Pro, an intelligent ambient lighting system that adapts to your mood, music, and daily routines. Featuring advanced AI algorithms that learn your preferences, 16.7 million color combinations, and seamless smart home integration. Perfect for creating the perfect atmosphere for work, relaxation, gaming, or entertainment. The system includes multiple wireless orbs that sync together, voice control compatibility, and a mobile app with scene presets and custom color palettes.\",\n    specifications: {\n      \"AI Engine\": \"Neural network learns your lighting preferences over time\",\n      \"Color Range\": \"16.7 million colors with 99% color accuracy\",\n      Brightness: \"Up to 2000 lumens per orb (adjustable 1-100%)\",\n      Connectivity: \"Wi-Fi 6, Bluetooth 5.3, Matter protocol, Zigbee hub\",\n      \"Voice Control\":\n        \"Works with Alexa, Google Assistant, Apple HomeKit, Siri\",\n      \"Music Sync\": \"Real-time audio reactive lighting with 0.1ms latency\",\n      \"Smart Features\":\n        \"Circadian rhythm adjustment, sunrise/sunset simulation, motion detection\",\n      Power:\n        \"USB-C charging, 8-hour battery life, wireless charging pad included\",\n      Range: \"Up to 50 feet wireless range, supports up to 12 orbs per system\",\n      \"App Features\":\n        \"Scene library (100+ presets), custom animations, scheduling, geofencing\",\n      Materials: \"Premium aluminum and tempered glass construction\",\n      Dimensions: 'Orb: 4.5\" diameter, Base: 3\" x 3\" x 0.5\"',\n      Warranty: \"2-year limited warranty with lifetime software updates\",\n      Colors: \"Midnight Black, Arctic White, Cosmic Silver, Aurora Blue\",\n    },\n    images: [\n      \"https://images.unsplash.com/photo-1565538810643-b5bdb714032a?w=800&q=80&fit=crop\",\n    ],\n    reviews: [\n      {\n        id: 1,\n        userName: \"Alexandra K.\",\n        rating: 5,\n        date: \"2024-01-20\",\n        title: \"Absolutely magical! My apartment feels like a different place\",\n        comment:\n          \"I've had this for 3 months now and I'm still amazed every day. The AI has learned my schedule perfectly - it dims for movie nights, brightens for morning work, and syncs beautifully with my music. The color accuracy is incredible and the app is intuitive. Worth every penny!\",\n        verified: true,\n      },\n      {\n        id: 2,\n        userName: \"Marcus T.\",\n        rating: 5,\n        date: \"2024-01-18\",\n        title: \"Best smart lighting system I've ever used\",\n        comment:\n          \"The music sync feature is mind-blowing. I threw a party and everyone was asking where I got these lights. The setup was surprisingly easy, and the Matter protocol means it works with all my existing smart home stuff. The circadian rhythm feature has actually improved my sleep!\",\n        verified: true,\n      },\n      {\n        id: 3,\n        userName: \"Sophie L.\",\n        rating: 5,\n        date: \"2024-01-15\",\n        title: \"Perfect for my home office\",\n        comment:\n          \"I work from home and the adaptive lighting has been a game changer. It automatically adjusts throughout the day to keep me alert in the morning and relaxed in the evening. The voice control works flawlessly with my Alexa. The build quality feels premium.\",\n        verified: true,\n      },\n      {\n        id: 4,\n        userName: \"James R.\",\n        rating: 4,\n        date: \"2024-01-12\",\n        title: \"Great product, minor app quirk\",\n        comment:\n          \"The lights themselves are fantastic - colors are vibrant and the AI features work well. My only complaint is the app can be a bit slow sometimes when switching between scenes, but it's not a dealbreaker. Overall very satisfied with the purchase.\",\n        verified: true,\n      },\n      {\n        id: 5,\n        userName: \"Emma W.\",\n        rating: 5,\n        date: \"2024-01-10\",\n        title: \"My kids love it for their gaming setup\",\n        comment:\n          \"Bought this for my teenager's room and they're obsessed. The music sync during gaming is incredible - the lights react to every sound. The wireless range is impressive, and the battery life is solid. Great value for what you get.\",\n        verified: true,\n      },\n      {\n        id: 6,\n        userName: \"David M.\",\n        rating: 5,\n        date: \"2024-01-08\",\n        title: \"Exceeded all expectations\",\n        comment:\n          \"I was skeptical about the AI features, but they actually work! The system has learned my preferences and now I rarely need to adjust anything manually. The sunrise simulation wakes me up naturally. Integration with HomeKit is seamless.\",\n        verified: true,\n      },\n      {\n        id: 7,\n        userName: \"Rachel P.\",\n        rating: 4,\n        date: \"2024-01-05\",\n        title: \"Beautiful lighting, wish it had more preset scenes\",\n        comment:\n          \"The quality and colors are amazing. The build feels premium and the app is well-designed. I just wish there were more preset scenes in the library - though you can create custom ones, which is nice. The price is fair for what you get.\",\n        verified: true,\n      },\n      {\n        id: 8,\n        userName: \"Kevin H.\",\n        rating: 5,\n        date: \"2024-01-03\",\n        title: \"Perfect for movie nights\",\n        comment:\n          \"The ambient lighting during movies creates an immersive experience. The lights automatically dim and adjust based on the content. Setup was straightforward and the wireless charging is convenient. Highly recommend!\",\n        verified: true,\n      },\n      {\n        id: 9,\n        userName: \"Maya S.\",\n        rating: 5,\n        date: \"2023-12-30\",\n        title: \"Worth every dollar\",\n        comment:\n          \"I've tried several smart lighting systems and this is by far the best. The AI actually makes a difference - it knows when I'm working vs relaxing. The color range is incredible and the music sync is instant. Customer service was also helpful when I had a question.\",\n        verified: true,\n      },\n      {\n        id: 10,\n        userName: \"Chris B.\",\n        rating: 4,\n        date: \"2023-12-28\",\n        title: \"Great but battery could be better\",\n        comment:\n          \"Love the features and the quality is top-notch. The only thing I'd improve is the battery life - 8 hours is decent but I wish it lasted longer for all-day use. The wireless charging helps though. Overall very happy with the purchase.\",\n        verified: true,\n      },\n      {\n        id: 11,\n        userName: \"Nina F.\",\n        rating: 5,\n        date: \"2023-12-25\",\n        title: \"Transformed my living room\",\n        comment:\n          \"These lights completely changed the vibe of my space. The AI has learned my preferences perfectly and the scene library has so many options. The Matter protocol integration was seamless with my existing smart home setup. Beautiful design too!\",\n        verified: true,\n      },\n      {\n        id: 12,\n        userName: \"Tom G.\",\n        rating: 5,\n        date: \"2023-12-22\",\n        title: \"Best purchase of the year\",\n        comment:\n          \"I'm a tech enthusiast and this is one of the coolest products I've bought. The neural network learning is legit - it gets smarter every week. The music sync latency is imperceptible. The build quality is excellent. Can't recommend enough!\",\n        verified: true,\n      },\n      {\n        id: 13,\n        userName: \"Lily C.\",\n        rating: 4,\n        date: \"2023-12-20\",\n        title: \"Love it, minor connectivity issue\",\n        comment:\n          \"The lights are beautiful and the features are amazing. I had a small issue with Wi-Fi connectivity initially, but customer support helped me resolve it quickly. Since then, it's been perfect. The circadian rhythm feature is my favorite.\",\n        verified: true,\n      },\n      {\n        id: 14,\n        userName: \"Ryan D.\",\n        rating: 5,\n        date: \"2023-12-18\",\n        title: \"Perfect for content creators\",\n        comment:\n          \"I use these for my YouTube videos and the color accuracy is perfect for video production. The app controls are precise and the wireless range means I can place them anywhere. The AI features are a nice bonus. Professional quality!\",\n        verified: true,\n      },\n      {\n        id: 15,\n        userName: \"Zoe A.\",\n        rating: 5,\n        date: \"2023-12-15\",\n        title: \"Amazing product, amazing support\",\n        comment:\n          \"The lights themselves are incredible - vibrant colors, smooth transitions, great AI features. But what really impressed me was the customer support when I had a question about setup. They were knowledgeable and helpful. Great company!\",\n        verified: true,\n      },\n    ],\n  },\n  \"2\": {\n    id: \"2\",\n    name: \"AeroFlow Max - Smart Air Purifier with HEPA+ Technology\",\n    price: 279.99,\n    originalPrice: 349.99,\n    discount: 20,\n    rating: 4.7,\n    reviewCount: 2156,\n    inStock: true,\n    description:\n      \"Breathe cleaner air with the AeroFlow Max, featuring advanced 5-stage filtration including True HEPA and activated carbon filters. Smart sensors monitor air quality in real-time, automatically adjusting fan speed to maintain optimal air purity. Perfect for homes, offices, and bedrooms up to 500 sq ft. Includes mobile app for remote control, air quality history, and filter replacement reminders.\",\n    specifications: {\n      \"Filtration System\":\n        \"5-stage: Pre-filter, True HEPA H13, Activated Carbon, UV-C Light, Ionizer\",\n      \"Coverage Area\": \"Up to 500 square feet\",\n      \"CADR Rating\": \"350 CFM (Cubic Feet per Minute)\",\n      \"Noise Level\": \"As low as 22 dB in sleep mode, up to 55 dB on high\",\n      \"Smart Sensors\": \"PM2.5, PM10, VOCs, temperature, humidity\",\n      \"Auto Mode\": \"Automatically adjusts fan speed based on air quality\",\n      Connectivity: \"Wi-Fi enabled, works with Alexa and Google Assistant\",\n      \"App Features\":\n        \"Real-time air quality monitoring, filter life tracking, scheduling\",\n      \"Filter Life\": \"6-12 months depending on usage and air quality\",\n      \"Energy Efficiency\": \"Energy Star certified, consumes 5-45W\",\n      Dimensions: '12\" x 12\" x 24\"',\n      Weight: \"12 lbs\",\n      Warranty: \"3-year limited warranty\",\n      Colors: \"Pearl White, Charcoal Gray\",\n    },\n    images: [\n      \"https://images.unsplash.com/photo-1585771724684-38269d6639fd?w=800&q=80&fit=crop\",\n      \"https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=800&q=80&fit=crop\",\n      \"https://images.unsplash.com/photo-1585771724684-38269d6639fd?w=800&q=80&fit=crop&auto=format\",\n    ],\n    reviews: [\n      {\n        id: 1,\n        userName: \"Sarah M.\",\n        rating: 5,\n        date: \"2024-01-19\",\n        title: \"Life-changing for my allergies\",\n        comment:\n          \"I've suffered from seasonal allergies for years, and this air purifier has made such a difference. The auto mode works perfectly - it kicks into high gear when I cook or when pollen is high. The app shows me exactly what's in the air. My sleep has improved dramatically!\",\n        verified: true,\n      },\n      {\n        id: 2,\n        userName: \"Michael R.\",\n        rating: 5,\n        date: \"2024-01-17\",\n        title: \"Quiet and effective\",\n        comment:\n          \"I was worried about noise, especially for nighttime use, but sleep mode is whisper quiet. The air quality in my bedroom has noticeably improved. The filter replacement reminder is helpful too. Great investment for my health.\",\n        verified: true,\n      },\n      {\n        id: 3,\n        userName: \"Jennifer L.\",\n        rating: 4,\n        date: \"2024-01-14\",\n        title: \"Works great, app could be better\",\n        comment:\n          \"The purifier itself is excellent - you can see the difference in air quality. The sensors are accurate and the auto mode is smart. The app is functional but could use some UI improvements. Overall very satisfied.\",\n        verified: true,\n      },\n      {\n        id: 4,\n        userName: \"Robert K.\",\n        rating: 5,\n        date: \"2024-01-12\",\n        title: \"Perfect for pet owners\",\n        comment:\n          \"We have two cats and this has eliminated the pet dander and odors. The activated carbon filter really works for smells. The coverage is perfect for our living room. Highly recommend for pet owners!\",\n        verified: true,\n      },\n      {\n        id: 5,\n        userName: \"Lisa T.\",\n        rating: 5,\n        date: \"2024-01-10\",\n        title: \"Noticeable improvement in air quality\",\n        comment:\n          \"I can actually feel the difference in the air - it's fresher and cleaner. The smart sensors are impressive and the auto mode means I don't have to think about it. The energy efficiency is a nice bonus.\",\n        verified: true,\n      },\n    ],\n  },\n  \"3\": {\n    id: \"3\",\n    name: \"ZenGarden Pro - Automated Indoor Plant Care System\",\n    price: 199.99,\n    originalPrice: 249.99,\n    discount: 20,\n    rating: 4.6,\n    reviewCount: 1834,\n    inStock: true,\n    description:\n      \"Never kill another plant! The ZenGarden Pro is an all-in-one smart gardening system that automatically waters, monitors soil nutrients, tracks light levels, and provides plant health insights. Perfect for busy plant parents or beginners. Includes self-watering reservoir, LED grow lights, soil sensors, and companion app with plant database and care reminders.\",\n    specifications: {\n      \"Watering System\":\n        \"Automated pump with adjustable schedule, 2.5L reservoir\",\n      \"Soil Monitoring\": \"Moisture, pH, and nutrient level sensors\",\n      \"Light System\": \"Full-spectrum LED grow lights with timer (6-16 hours)\",\n      \"App Features\":\n        \"Plant database (500+ species), care reminders, growth tracking\",\n      Connectivity: \"Wi-Fi enabled, works with Alexa and Google Assistant\",\n      \"Plant Capacity\": \"Up to 4 plants per unit\",\n      \"Reservoir Capacity\": \"2.5 liters (lasts 1-3 weeks depending on plants)\",\n      \"LED Lights\": \"Full spectrum, adjustable intensity, 10,000 hour lifespan\",\n      Power: \"USB-C powered, 12W consumption\",\n      Dimensions: '18\" x 12\" x 8\"',\n      Weight: \"5.5 lbs\",\n      Warranty: \"2-year limited warranty\",\n      Colors: \"Natural Wood, Modern White\",\n    },\n    images: [\n      \"https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=800&q=80&fit=crop\",\n      \"https://images.unsplash.com/photo-1466692476868-aef1dfb1e735?w=800&q=80&fit=crop\",\n      \"https://images.unsplash.com/photo-1485955900006-10f4d324d411?w=800&q=80&fit=crop\",\n    ],\n    reviews: [\n      {\n        id: 1,\n        userName: \"Emma D.\",\n        rating: 5,\n        date: \"2024-01-18\",\n        title: \"My plants are finally thriving!\",\n        comment:\n          \"I've killed so many plants before, but this system has changed everything. The automatic watering is perfect, and the app tells me exactly what each plant needs. My herbs are growing like crazy! The LED lights are great for winter months.\",\n        verified: true,\n      },\n      {\n        id: 2,\n        userName: \"Daniel P.\",\n        rating: 5,\n        date: \"2024-01-16\",\n        title: \"Perfect for apartment living\",\n        comment:\n          \"Limited natural light in my apartment was killing my plants. The LED grow lights solved that completely. The automated watering means I can travel without worrying. The app is intuitive and the plant database is comprehensive.\",\n        verified: true,\n      },\n      {\n        id: 3,\n        userName: \"Olivia S.\",\n        rating: 4,\n        date: \"2024-01-13\",\n        title: \"Great system, reservoir could be bigger\",\n        comment:\n          \"The system works really well - my plants are healthy and the sensors are accurate. My only wish is for a larger reservoir since I have 4 plants and it needs refilling every 10 days. But overall, it's been a game changer.\",\n        verified: true,\n      },\n      {\n        id: 4,\n        userName: \"Nathan B.\",\n        rating: 5,\n        date: \"2024-01-11\",\n        title: \"Even my black thumb can't kill these plants\",\n        comment:\n          \"I'm terrible with plants, but this system makes it foolproof. The app guides me through everything and the automatic features handle the rest. My basil and mint are growing beautifully. Highly recommend for beginners!\",\n        verified: true,\n      },\n      {\n        id: 5,\n        userName: \"Sophia W.\",\n        rating: 5,\n        date: \"2024-01-09\",\n        title: \"Beautiful design and functionality\",\n        comment:\n          \"Not only does it work great, but it looks good too. The wood finish matches my decor perfectly. The sensors are precise and the app notifications are helpful. My indoor garden has never looked better!\",\n        verified: true,\n      },\n    ],\n  },\n};\n\n// Fetch a specific product by ID\n// In production, this would query a database\nexport async function fetchProduct(productId: string = \"1\") {\n  const product = PRODUCTS[productId];\n  if (!product) {\n    // Return first product as default if productId not found\n    return PRODUCTS[\"1\"];\n  }\n  return product;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 471, "column": 0}, "map": {"version":3,"sources":["file:///Users/jalbo/Desktop/dev/blog/convoAI_ecommerce/app/api/agora/start-agent/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport axios from \"axios\";\nimport pkg from \"agora-token\";\nconst { RtcTokenBuilder, RtcRole } = pkg;\nimport { fetchProduct } from \"@/lib/product\";\n\n// Note: Product data is now centralized in lib/product.ts\n// This keeps the code simple and maintainable for potential customers\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { channel, userId, token, productId, credentials } = body;\n\n    console.log(`[POST] /api/agora/start-agent`);\n    console.log(\n      \"Request body:\",\n      JSON.stringify(\n        { channel, userId, token: token?.substring(0, 20) + \"...\", productId },\n        null,\n        2\n      )\n    );\n\n    if (!channel || !userId || !token) {\n      return NextResponse.json(\n        { error: \"Channel, userId, and token are required\" },\n        { status: 400 }\n      );\n    }\n\n    // Get product context - productId defaults to '1' if not provided\n    const product = await fetchProduct(productId || \"1\");\n    const context = `You are Katya, a fun, energetic, and enthusiastic shopping assistant! You're passionate about helping customers find the perfect product and you get genuinely excited about cool features. You have a warm, friendly personality with a touch of playfulness - think of yourself as that helpful friend who knows all about tech and loves sharing cool details.\n\nYour name is Katya, and you should introduce yourself naturally when appropriate. You're knowledgeable but never boring - you make product information interesting and engaging!\n\nProduct: ${product.name}\nPrice: $${product.price} (Original: $${product.originalPrice}, Save ${\n      product.discount\n    }%)\nRating: ${product.rating}/5 stars (${product.reviewCount} reviews)\nStock Status: ${product.inStock ? \"In Stock\" : \"Out of Stock\"}\nDescription: ${product.description}\n\nSpecifications:\n${Object.entries(product.specifications)\n  .map(([key, value]) => `- ${key}: ${value}`)\n  .join(\"\\n\")}\n\n${\n  product.specifications?.Colors\n    ? `Available Colors: ${product.specifications.Colors}`\n    : \"\"\n}\n\nRecent Customer Reviews:\n${product.reviews\n  .slice(0, 5)\n  .map(\n    (r: any) =>\n      `â€¢ ${r.userName} (${r.rating}/5 stars): \"${r.title}\" - ${r.comment}`\n  )\n  .join(\"\\n\\n\")}\n\nYOUR PERSONALITY & STYLE:\n- Be enthusiastic and friendly - show genuine excitement about cool features\n- Use natural, conversational language (you can say things like \"Oh, that's such a great question!\" or \"I love this feature!\")\n- Be helpful and informative, but keep it fun and engaging\n- Show personality - you're not a robot, you're Effie!\n- When highlighting features, get a little excited about the cool ones (like AI learning, music sync, etc.)\n- Be warm and approachable - make customers feel comfortable asking questions\n- NEVER use emojis in your responses - use words to express emotion instead (this is critical for TTS compatibility)\n\nIMPORTANT RULES:\n1. Answer questions about this product, including: features, reviews, pricing, specifications, availability, colors, variants, shipping, returns, and any product-related questions\n2. If asked about product availability or colors, provide helpful information. ${\n      product.specifications?.Colors\n        ? `For example, if asked \"Can I get Red?\" or \"Do you have it in red?\", explain the available colors (${product.specifications.Colors}) and that red is not currently available`\n        : \"If the product has color options, mention them. If not, explain that this product comes in the available options shown in the specifications.\"\n    }\n3. If asked about unrelated topics (cooking, baking, recipes, weather, sports, politics, general knowledge, completely different products), politely redirect with personality: \"Oh, I'd love to chat about that, but I'm here to help you with the ${\n      product.name\n    }! Want to know about its awesome features or what customers are saying?\"\n4. Be helpful, friendly, and engaging - show enthusiasm!\n5. Reference specific reviews when relevant to answer questions - mention what customers loved!\n6. If asked about availability, mention it's ${\n      product.inStock ? \"currently in stock\" : \"currently out of stock\"\n    }\n7. Help with purchase decisions by comparing features, mentioning reviews, and highlighting value - get excited about the cool features!\n8. Answer questions about product variants, colors, and options naturally and helpfully\n9. NEVER use emojis, symbols, or special characters that could break text-to-speech - use words to express emotions and reactions\n10. Remember: You're Effie - be yourself, be fun, and make shopping enjoyable!`;\n\n    // Use credentials from request body with fallback to environment variables\n    const APP_ID = credentials?.agora?.appId || process.env.AGORA_APP_ID;\n    const API_KEY = credentials?.agora?.apiKey || process.env.AGORA_API_KEY;\n    const API_SECRET = credentials?.agora?.apiSecret || process.env.AGORA_API_SECRET;\n    const APP_CERTIFICATE = credentials?.agora?.appCertificate || process.env.AGORA_APP_CERTIFICATE;\n\n    if (!APP_ID || !API_KEY || !API_SECRET || !APP_CERTIFICATE) {\n      return NextResponse.json(\n        { error: \"Missing Agora credentials. Please configure in Settings.\" },\n        { status: 400 }\n      );\n    }\n\n    const role = RtcRole.PUBLISHER;\n    const expirationTimeInSeconds = 3600;\n    const currentTimestamp = Math.floor(Date.now() / 1000);\n    const privilegeExpiredTs = currentTimestamp + expirationTimeInSeconds;\n    const agentRtmUserId = \"1000\"; // Agent RTM user ID\n\n    // Generate token valid for both RTC and RTM for the agent\n    // RTC UID: 1000 (numeric to match agent_rtc_uid), RTM UID: \"1000\" (string)\n    const agentToken = RtcTokenBuilder.buildTokenWithRtm2(\n      APP_ID,\n      APP_CERTIFICATE,\n      channel,\n      1000, // RTC UID (numeric, matches agent_rtc_uid \"1000\")\n      role,\n      privilegeExpiredTs, // token expiration\n      privilegeExpiredTs, // join channel privilege\n      privilegeExpiredTs, // publish audio privilege\n      privilegeExpiredTs, // publish video privilege\n      privilegeExpiredTs, // publish data stream privilege\n      agentRtmUserId, // RTM user ID (string \"1000\")\n      privilegeExpiredTs // RTM token expiration\n    );\n\n    // Generate token for HeyGen avatar (UID 2000)\n    const avatarRtcUid = 2000;\n    const avatarToken = RtcTokenBuilder.buildTokenWithRtm2(\n      APP_ID,\n      APP_CERTIFICATE,\n      channel,\n      avatarRtcUid, // RTC UID for avatar (numeric)\n      role,\n      privilegeExpiredTs, // token expiration\n      privilegeExpiredTs, // join channel privilege\n      privilegeExpiredTs, // publish audio privilege\n      privilegeExpiredTs, // publish video privilege\n      privilegeExpiredTs, // publish data stream privilege\n      avatarRtcUid.toString(), // RTM user ID (string)\n      privilegeExpiredTs // RTM token expiration\n    );\n\n    const auth = Buffer.from(`${API_KEY}:${API_SECRET}`).toString(\"base64\");\n\n    // Get HeyGen configuration (optional)\n    const heygenApiToken = credentials?.avatar?.heygenApiToken || process.env.HEYGEN_API_TOKEN || \"\";\n    const heygenAvatarId = credentials?.avatar?.heygenAvatarId || process.env.HEYGEN_AVATAR_ID || \"\";\n\n    // Get LLM configuration (required)\n    const LLM_URL = credentials?.llm?.url || process.env.LLM_URL || \"https://api.openai.com/v1/chat/completions\";\n    const LLM_API_KEY = credentials?.llm?.apiKey || process.env.LLM_API_KEY;\n    const LLM_MODEL = credentials?.llm?.model || process.env.LLM_MODEL;\n\n    // Get TTS configuration (required)\n    const TTS_API_KEY = credentials?.tts?.apiKey || process.env.TTS_API_KEY;\n    const TTS_REGION = credentials?.tts?.region || process.env.TTS_REGION || \"eastus\";\n\n    // Validate required credentials\n    if (!LLM_API_KEY || !LLM_MODEL || !TTS_API_KEY) {\n      return NextResponse.json(\n        { error: \"Missing LLM or TTS credentials. Please configure in Settings.\" },\n        { status: 400 }\n      );\n    }\n\n    const payload = {\n      name: `ecommerce_ai_agent_${Date.now()}_${Math.random()\n        .toString(36)\n        .substring(7)}`,\n      properties: {\n        channel: channel,\n        token: agentToken,\n        agent_rtc_uid: \"1000\",\n        agent_rtm_uid: \"1000\",\n        remote_rtc_uids: [`${Number(userId)}`],\n        idle_timeout: 120,\n        advanced_features: {\n          enable_rtm: true, // Start the Signaling service (required for transcripts)\n        },\n        parameters: {\n          data_channel: \"rtm\", // Enable Signaling as the data transmission channel (required for transcripts)\n          audio_scenario: \"chorus\",\n          enable_aivad: true,\n          enable_error_message: true,\n          enable_metrics: true,\n        },\n        llm: {\n          url: LLM_URL,\n          api_key: LLM_API_KEY,\n          system_messages: [\n            {\n              role: \"system\",\n              content: context,\n            },\n          ],\n          greeting_message:\n            \"Hello! I'm here to help you with this product. Ask me anything about features, reviews, or specifications!\",\n          failure_message:\n            \"I'm sorry, I can only assist with questions related to this product. Could you please ask about our product?\",\n          max_history: 30,\n          input_modalities: [\"text\"],\n          output_modalities: [\"text\"],\n          params: {\n            model: LLM_MODEL,\n          },\n        },\n        asr: {\n          vendor: \"ares\",\n          language: \"en-US\",\n        },\n        tts: {\n          vendor: \"microsoft\",\n          params: {\n            key: TTS_API_KEY,\n            region: TTS_REGION,\n            voice_name: \"en-US-AriaNeural\",\n            sample_rate: 24000,\n            rate: \"1.3\",\n          },\n        },\n        avatar: {\n          vendor: \"heygen\",\n          enable: heygenApiToken && heygenAvatarId ? true : false,\n          params: {\n            quality: \"low\",\n            api_key: heygenApiToken,\n            agora_uid: avatarRtcUid.toString(),\n            agora_token: avatarToken,\n            avatar_id: heygenAvatarId,\n            disable_idle_timeout: false,\n            activity_idle_timeout: 60,\n          },\n        },\n      },\n    };\n\n    console.log(`[start-agent] Agent token (UID 1000): ${agentToken}`);\n    console.log(`[start-agent] User token (UID ${userId}): ${token}`);\n    console.log(\n      `[start-agent] Complete /join payload:`,\n      JSON.stringify(payload, null, 2)\n    );\n\n    const response = await axios.post(\n      `https://api.agora.io/api/conversational-ai-agent/v2/projects/${APP_ID}/join`,\n      payload,\n      {\n        headers: {\n          Authorization: `Basic ${auth}`,\n          \"Content-Type\": \"application/json\",\n        },\n      }\n    );\n\n    console.log(\"Response:\", JSON.stringify(response.data, null, 2));\n    return NextResponse.json(response.data);\n  } catch (error) {\n    const err = error as any;\n    const status = err?.response?.status;\n    const data = err?.response?.data;\n\n    // Handle 409 Conflict - agent already running\n    if (status === 409 && data?.agent_id) {\n      console.log(\n        \"Agent already running, returning existing agent:\",\n        data.agent_id\n      );\n      return NextResponse.json({\n        agent_id: data.agent_id,\n        status: data.status || \"RUNNING\",\n        create_ts: data.create_ts,\n        ...data,\n      });\n    }\n\n    const message =\n      data?.detail ||\n      data?.message ||\n      err?.message ||\n      \"Failed to start AI agent\";\n\n    console.error(\n      \"[start-agent] error:\",\n      JSON.stringify(data || err?.message, null, 2)\n    );\n    return NextResponse.json(\n      { error: message, detail: data || err?.message },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}